<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧股票投資組合管理系統</title>
    
    <!-- 引入 React 與 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* 自定義動畫 */
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fade-in-down 0.3s ease-out; }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out; }
        
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 圖示組件 (將 Lucide Icons 轉為 SVG) ---
        const Icon = ({ name, className, ...props }) => {
            const icons = {
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,
                Mail: <g><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></g>,
                Clock: <g><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></g>,
                Pause: <g><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></g>,
                Play: <polygon points="5 3 19 12 5 21 5 3"/>,
                Database: <g><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></g>,
                Wifi: <path d="M5 12.55a11 11 0 0 1 14.08 0M1.42 9a16 16 0 0 1 21.16 0M8.53 16.11a6 6 0 0 1 6.95 0M12 20h.01"/>,
                WifiOff: <path d="M2 2l20 20M8.5 16a6 6 0 0 1 6 6M2 2l0 0M5 12.55a11 11 0 0 1 5 1.5M1.42 9a16 16 0 0 1 9.5 2M20 9a16 16 0 0 1 1.58.5M16 9v.01"/>,
                RefreshCw: <g><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></g>,
                Edit3: <path d="M12 20h9M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>,
                X: <path d="M18 6 6 18M6 6l12 12"/>,
                Trash2: <g><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></g>,
                Plus: <path d="M5 12h14M12 5v14"/>,
                TrendingUp: <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>,
                TrendingDown: <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>,
                PieChart: <g><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></g>,
                Save: <g><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></g>,
                FileCode: <g><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></g>,
                Search: <g><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></g>,
                AlertCircle: <g><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></g>,
                ExternalLink: <g><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></g>,
                ArrowRight: <g><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></g>,
                PenTool: <g><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></g>,
                Globe: <g><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></g>
            };

            const content = icons[name] || <circle cx="12" cy="12" r="10" />;
            
            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width="24" 
                    height="24" 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                    {...props}
                >
                    {content}
                </svg>
            );
        };

        const StockPortfolioApp = () => {
            // 內建熱門股票代碼對照表
            const defaultStockMasterData = {
                // === 上市權值股 ===
                '2330': { name: '台積電', category: '半導體業', market: '上市' },
                '2317': { name: '鴻海', category: '其他電子業', market: '上市' },
                '2454': { name: '聯發科', category: '半導體業', market: '上市' },
                '2308': { name: '台達電', category: '電子零組件業', market: '上市' },
                '2303': { name: '聯電', category: '半導體業', market: '上市' },
                '2881': { name: '富邦金', category: '金融保險業', market: '上市' },
                '2882': { name: '國泰金', category: '金融保險業', market: '上市' },
                '2382': { name: '廣達', category: '電腦及週邊設備業', market: '上市' },
                '2412': { name: '中華電', category: '通信網路業', market: '上市' },
                '2891': { name: '中信金', category: '金融保險業', market: '上市' },
                '2886': { name: '兆豐金', category: '金融保險業', market: '上市' },
                '3711': { name: '日月光投控', category: '半導體業', market: '上市' },
                '2884': { name: '玉山金', category: '金融保險業', market: '上市' },
                '2002': { name: '中鋼', category: '鋼鐵工業', market: '上市' },
                '1216': { name: '統一', category: '食品工業', market: '上市' },
                '1301': { name: '台塑', category: '塑膠工業', market: '上市' },
                '1303': { name: '南亞', category: '塑膠工業', market: '上市' },
                '2603': { name: '長榮', category: '航運業', market: '上市' },
                '2609': { name: '陽明', category: '航運業', market: '上市' },
                '2615': { name: '萬海', category: '航運業', market: '上市' },
                '2357': { name: '華碩', category: '電腦及週邊設備業', market: '上市' },
                '3231': { name: '緯創', category: '電腦及週邊設備業', market: '上市' },
                '3034': { name: '聯詠', category: '半導體業', market: '上市' },
                '3008': { name: '大立光', category: '光電業', market: '上市' },
                '2912': { name: '統一超', category: '貿易百貨業', market: '上市' },
                '3045': { name: '台灣大', category: '通信網路業', market: '上市' },
                '4904': { name: '遠傳', category: '通信網路業', market: '上市' },
                '5880': { name: '合庫金', category: '金融保險業', market: '上市' },
                '1101': { name: '台泥', category: '水泥工業', market: '上市' },
                '1102': { name: '亞泥', category: '水泥工業', market: '上市' },
                '6669': { name: '緯穎', category: '電腦及週邊設備業', market: '上市' },
                '2379': { name: '瑞昱', category: '半導體業', market: '上市' },
                '3037': { name: '欣興', category: '電子零組件業', market: '上市' },
                '2345': { name: '智邦', category: '通信網路業', market: '上市' },
                '2395': { name: '研華', category: '電腦及週邊設備業', market: '上市' },
                
                // === 熱門 ETF ===
                '0050': { name: '元大台灣50', category: 'ETF', market: '上市' },
                '0056': { name: '元大高股息', category: 'ETF', market: '上市' },
                '00878': { name: '國泰永續高股息', category: 'ETF', market: '上市' },
                '00929': { name: '復華台灣科技優息', category: 'ETF', market: '上市' },
                '00919': { name: '群益台灣精選高息', category: 'ETF', market: '上市' },
                '006208': { name: '富邦台50', category: 'ETF', market: '上市' },
                
                // === 上櫃熱門 ===
                '8069': { name: '元太', category: '光電業', market: '上櫃' },
                '6488': { name: '環球晶', category: '半導體業', market: '上櫃' },
                '5904': { name: '寶雅', category: '貿易百貨業', market: '上櫃' },
                '3293': { name: '鈊象', category: '文化創意業', market: '上櫃' }
            };

            // 初始真實數據 (來源: Google Search, 2026/01/27)
            const initialStocks = [
                {
                    id: 1,
                    code: '2330',
                    name: '台積電',
                    category: '半導體業',
                    market: '上市',
                    buyDate: '2023-01-15',
                    shares: 1000,
                    buyPrice: 500,
                    currentPrice: 1775,
                    lastUpdate: '2026/01/27 13:25',
                    eps: 30.5,
                    pe: 28.68,
                    beta: 1.46,
                    stdDev: 0.25, 
                },
                {
                    id: 2,
                    code: '2317',
                    name: '鴻海',
                    category: '其他電子業',
                    market: '上市',
                    buyDate: '2023-05-20',
                    shares: 1000,
                    buyPrice: 105,
                    currentPrice: 225.5,
                    lastUpdate: '2026/01/27 13:25',
                    eps: 13.44,
                    pe: 16.77,
                    beta: 1.0,
                    stdDev: 0.20,
                },
                {
                    id: 3,
                    code: '2454',
                    name: '聯發科',
                    category: '半導體業',
                    market: '上市',
                    buyDate: '2023-06-10',
                    shares: 1000,
                    buyPrice: 750,
                    currentPrice: 1775,
                    lastUpdate: '2026/01/27 13:25',
                    eps: 66.62,
                    pe: 26.64,
                    beta: 1.01,
                    stdDev: 0.22,
                },
                {
                    id: 4,
                    code: '0050',
                    name: '元大台灣50',
                    category: 'ETF',
                    market: '上市',
                    buyDate: '2024-01-01',
                    shares: 1000,
                    buyPrice: 130,
                    currentPrice: 73.05,
                    lastUpdate: '2026/01/27 13:25',
                    eps: 0,
                    pe: 0,
                    beta: 1.0,
                    stdDev: 0.15,
                }
            ];

            const [stocks, setStocks] = useState(initialStocks);
            const [stockMasterData, setStockMasterData] = useState(defaultStockMasterData);
            const [dataDate, setDataDate] = useState(null); 
            
            const [currentTime, setCurrentTime] = useState(new Date());
            const [isAutoUpdate, setIsAutoUpdate] = useState(false);
            const [fetchStatus, setFetchStatus] = useState('idle');

            const [isFormOpen, setIsFormOpen] = useState(false);
            const [isDataImportOpen, setIsDataImportOpen] = useState(false);
            const [isPriceUpdateOpen, setIsPriceUpdateOpen] = useState(false);
            const [isResourcesOpen, setIsResourcesOpen] = useState(false); // 新增：控制資源視窗
            const [priceUpdateData, setPriceUpdateData] = useState({}); 
            const [importStatus, setImportStatus] = useState(null);
            const [editingId, setEditingId] = useState(null);
            
            const [newStock, setNewStock] = useState({
                code: '',
                name: '',
                category: '',
                market: '上市',
                buyDate: new Date().toISOString().split('T')[0],
                shares: 1000,
                buyPrice: 0,
                currentPrice: 0,
                eps: 0,
                pe: 0,
                beta: 1.0,
                stdDev: 0.2,
            });

            // 外部資源連結清單
            const resourceLinks = [
                { name: 'Yahoo 股市 (台灣)', url: 'https://tw.stock.yahoo.com', desc: '即時報價、新聞、個股分析' },
                { name: 'Yahoo 財經 (香港)', url: 'https://hk.finance.yahoo.com/topic/latest-news', desc: '國際財經新聞、港股美股' },
                { name: 'CMoney 股市爆料同學會', url: 'https://www.cmoney.tw/app/default.aspx', desc: '股民討論、籌碼分析' },
                { name: '公開資訊觀測站 (MOPS)', url: 'https://mops.twse.com.tw/mops/#/web/home', desc: '官方財報、重大訊息公告' },
                { name: '玩股網 Wantgoo', url: 'https://www.wantgoo.com/index/listed/industry', desc: '技術線圖、國際指數' },
                { name: '元大證券', url: 'https://www.yuanta.com.tw/', desc: '券商官網、投資研究報告' }
            ];

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                let interval;
                if (isAutoUpdate) {
                    interval = setInterval(() => {
                        fetchRealTimeData();
                    }, 10000); // 每 10 秒
                }
                return () => clearInterval(interval);
            }, [isAutoUpdate]);

            useEffect(() => {
                const savedStocks = localStorage.getItem('myStockPortfolio');
                const savedMasterData = localStorage.getItem('myStockMasterData');
                const savedDataDate = localStorage.getItem('myStockDataDate'); 
                
                if (savedStocks) {
                    setStocks(JSON.parse(savedStocks));
                }
                if (savedMasterData) {
                    const parsedData = JSON.parse(savedMasterData);
                    setStockMasterData(prev => ({ ...prev, ...parsedData }));
                }
                if (savedDataDate) {
                    setDataDate(savedDataDate);
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('myStockPortfolio', JSON.stringify(stocks));
            }, [stocks]);

            useEffect(() => {
                localStorage.setItem('myStockMasterData', JSON.stringify(stockMasterData));
            }, [stockMasterData]);

            useEffect(() => {
                if (dataDate) {
                    localStorage.setItem('myStockDataDate', dataDate);
                }
            }, [dataDate]);

            const totalCost = stocks.reduce((acc, stock) => acc + (stock.buyPrice * stock.shares), 0);
            const totalValue = stocks.reduce((acc, stock) => acc + (stock.currentPrice * stock.shares), 0);
            const totalPL = totalValue - totalCost;
            const totalROI = totalCost > 0 ? (totalPL / totalCost) * 100 : 0;

            const getStockLink = (code, market) => {
                const suffix = (market === '上櫃' || market === '興櫃') ? '.TWO' : '.TW';
                return `https://tw.stock.yahoo.com/quote/${code}${suffix}`;
            };

            const parseHtmlContent = (content, fileName) => {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    let extractedDate = null;
                    const h2Elements = doc.querySelectorAll('h2');
                    h2Elements.forEach(h2 => {
                        if (h2.textContent.includes('最近更新日期')) {
                            const match = h2.textContent.match(/(\d{4}\/\d{2}\/\d{2})/);
                            if (match) extractedDate = match[1];
                        }
                    });

                    const table = doc.querySelector('table.h4');
                    if (!table) return { count: 0, data: {}, date: extractedDate };

                    const rows = table.querySelectorAll('tr');
                    let count = 0;
                    const newData = {};

                    rows.forEach((row, index) => {
                        if (index === 0) return;

                        const cells = row.querySelectorAll('td');
                        if (cells.length >= 5) {
                            const rawCodeName = cells[0].textContent.trim();
                            const market = cells[3]?.textContent.trim();
                            const industry = cells[4]?.textContent.trim();
                            const parts = rawCodeName.split(/[\s\u3000]+/); 
                            
                            if (parts.length >= 2) {
                                const code = parts[0].trim();
                                const name = parts[1].trim();

                                if (code && !isNaN(parseInt(code[0]))) {
                                    newData[code] = { 
                                        name: name, 
                                        category: industry || '其他',
                                        market: market || (fileName.includes('public2') ? '上櫃' : fileName.includes('public3') ? '興櫃' : '上市')
                                    };
                                    count++;
                                }
                            }
                        }
                    });
                    return { count, data: newData, date: extractedDate };
                } catch (error) {
                    console.error("Parse error:", error);
                    return { count: 0, data: {}, date: null };
                }
            };

            const handleFileUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                let totalNew = 0;
                let latestDate = dataDate;
                const mergedData = { ...stockMasterData };

                setImportStatus('正在處理檔案...');

                for (const file of files) {
                    const text = await file.text();
                    let result = { count: 0, data: {}, date: null };

                    if (file.name.endsWith('.htm') || file.name.endsWith('.html')) {
                        result = parseHtmlContent(text, file.name);
                        if (result.date) {
                            if (!latestDate || result.date > latestDate) {
                                latestDate = result.date;
                            }
                        }
                    } else if (file.name.endsWith('.csv')) {
                        const lines = text.split('\n');
                        lines.forEach((line, index) => {
                            if (index === 0) return;
                            const cols = line.split(',');
                            if (cols.length >= 2) {
                                const code = cols[0].trim();
                                const name = cols[1].trim();
                                if (code && name && !isNaN(parseInt(code))) {
                                    result.data[code] = { name, category: 'CSV匯入', market: '自定義' };
                                    result.count++;
                                }
                            }
                        });
                    }

                    if (result.count > 0) {
                        Object.assign(mergedData, result.data);
                        totalNew += result.count;
                    }
                }

                setStockMasterData(mergedData);
                if (latestDate) setDataDate(latestDate);
                
                setImportStatus(`成功！匯入 ${totalNew} 筆資料。${latestDate ? `(資料日期: ${latestDate})` : ''}`);
                setTimeout(() => {
                    setIsDataImportOpen(false);
                    setImportStatus(null);
                }, 3000);
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                if (name === 'code') {
                    const trimmedValue = value.trim();
                    setNewStock(prev => {
                        let updated = { ...prev, [name]: trimmedValue };
                        if (stockMasterData[trimmedValue]) {
                            const data = stockMasterData[trimmedValue];
                            updated.name = data.name;
                            updated.category = data.category;
                            updated.market = data.market || '上市';
                        }
                        return updated;
                    });
                } else {
                    setNewStock({ ...newStock, [name]: value });
                }
            };

            const handleEditStock = (stock) => {
                setNewStock({
                    code: stock.code,
                    name: stock.name,
                    category: stock.category,
                    market: stock.market || '上市',
                    buyDate: stock.buyDate,
                    shares: stock.shares,
                    buyPrice: stock.buyPrice,
                    currentPrice: stock.currentPrice,
                    eps: stock.eps || 0,
                    pe: stock.pe || 0,
                    beta: stock.beta || 0,
                    stdDev: stock.stdDev || 0,
                });
                setEditingId(stock.id);
                setIsFormOpen(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleSaveStock = (e) => {
                e.preventDefault();
                
                // 自動記憶新股票邏輯
                const code = newStock.code.trim();
                const name = newStock.name.trim();
                
                if (code && name) {
                    // 如果代碼不存在，或者名稱被修改過，就更新 Master Data
                    if (!stockMasterData[code] || stockMasterData[code].name !== name) {
                        setStockMasterData(prev => ({
                            ...prev,
                            [code]: {
                                name: name,
                                // 如果是既有股票，保留原有分類；若是新股，則預設為自選股
                                category: stockMasterData[code]?.category || '自選股',
                                market: stockMasterData[code]?.market || '自定義'
                            }
                        }));
                    }
                }

                const stockData = {
                    ...newStock,
                    // 如果 newStock.category 為空 (手動輸入新股時)，則使用預設值
                    category: newStock.category || (stockMasterData[code]?.category || '自選股'),
                    market: newStock.market || (stockMasterData[code]?.market || '自定義'),
                    shares: Number(newStock.shares),
                    buyPrice: Number(newStock.buyPrice),
                    currentPrice: Number(newStock.currentPrice) || Number(newStock.buyPrice),
                    eps: Number(newStock.eps),
                    pe: Number(newStock.pe),
                    beta: Number(newStock.beta),
                    stdDev: Number(newStock.stdDev),
                };

                if (editingId) {
                    setStocks(stocks.map(stock => 
                        stock.id === editingId ? { ...stockData, id: editingId, lastUpdate: stock.lastUpdate } : stock
                    ));
                    setEditingId(null);
                } else {
                    setStocks([...stocks, { 
                        ...stockData, 
                        id: Date.now(), 
                        lastUpdate: new Date().toLocaleDateString() 
                    }]);
                }

                setIsFormOpen(false);
                setNewStock({ ...newStock, code: '', name: '', shares: 1000, buyPrice: 0, currentPrice: 0 });
            };

            const cancelEdit = () => {
                setIsFormOpen(false);
                setEditingId(null);
                setNewStock({ ...newStock, code: '', name: '', shares: 1000, buyPrice: 0, currentPrice: 0 });
            };

            const deleteStock = (id) => {
                if (window.confirm('確定要刪除這筆交易紀錄嗎？')) {
                    setStocks(stocks.filter(stock => stock.id !== id));
                }
            };

            const openPriceUpdateModal = () => {
                const initialData = {};
                stocks.forEach(s => {
                    initialData[s.id] = s.currentPrice;
                });
                setPriceUpdateData(initialData);
                setIsPriceUpdateOpen(true);
            };

            const handlePriceUpdateChange = (id, value) => {
                setPriceUpdateData(prev => ({
                    ...prev,
                    [id]: value
                }));
            };

            const saveBatchPrices = () => {
                const now = new Date();
                const timeString = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                
                const updatedStocks = stocks.map(stock => {
                    if (priceUpdateData[stock.id] !== undefined && priceUpdateData[stock.id] !== '') {
                        return {
                            ...stock,
                            currentPrice: Number(priceUpdateData[stock.id]),
                            lastUpdate: timeString
                        };
                    }
                    return stock;
                });
                setStocks(updatedStocks);
                setIsPriceUpdateOpen(false);
            };

            const fetchRealTimeData = () => {
                setFetchStatus('fetching');
                const now = new Date();
                const timeString = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                
                setTimeout(() => {
                    setStocks(prevStocks => {
                        return prevStocks.map(stock => {
                            return { 
                                ...stock, 
                                lastUpdate: timeString + ' (已檢查)'
                            };
                        });
                    });
                    setFetchStatus('success');
                    setTimeout(() => setFetchStatus('idle'), 3000);
                }, 800); 
            };

            const calculateFairValue = (eps, pe) => (eps * pe).toFixed(2);

            const getMarketBadgeColor = (market) => {
                if (market === '上市') return 'bg-blue-100 text-blue-800';
                if (market === '上櫃') return 'bg-orange-100 text-orange-800';
                if (market === '興櫃') return 'bg-green-100 text-green-800';
                return 'bg-gray-100 text-gray-800';
            };

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans">
                    <header className="bg-slate-900 text-white p-4 shadow-md sticky top-0 z-20">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center gap-4 md:gap-0">
                            <div className="flex flex-col">
                                <div className="flex items-center gap-3">
                                    <Icon name="Activity" className="h-6 w-6 text-emerald-400" />
                                    <h1 className="text-xl md:text-2xl font-bold">智慧股票投資組合</h1>
                                </div>
                                
                                <div className="flex items-center gap-2 text-xs text-slate-400 ml-0 md:ml-9 mt-1">
                                    <span>(設計者 吳啓仲)</span>
                                    <a 
                                        href="mailto:0922693981ab11@gmail.com" 
                                        className="flex items-center gap-1 hover:text-white transition-colors bg-slate-800 hover:bg-slate-700 px-2 py-0.5 rounded-full border border-slate-700"
                                    >
                                        <Icon name="Mail" className="h-3 w-3 text-emerald-400" />
                                        <span className="hidden sm:inline">聯絡我</span>
                                    </a>
                                </div>
                            </div>

                            <div className="flex gap-2 items-center self-end md:self-center">
                                <div className="flex flex-col items-end mr-2 text-right">
                                    <div className="text-xl font-mono font-bold text-emerald-400 leading-none">
                                        {currentTime.toLocaleTimeString('en-US', { hour12: false })}
                                    </div>
                                    <div className="text-[10px] text-slate-400">
                                        {currentTime.toLocaleDateString()}
                                    </div>
                                </div>

                                <button 
                                    onClick={() => setIsAutoUpdate(!isAutoUpdate)}
                                    className={`flex items-center gap-1 px-3 py-2 rounded-lg transition text-xs md:text-sm font-medium border ${isAutoUpdate ? 'bg-red-600 border-red-500 hover:bg-red-500 text-white animate-pulse' : 'bg-slate-800 border-slate-700 text-gray-300 hover:bg-slate-700'}`}
                                    title={isAutoUpdate ? "點擊停止自動更新 (每10秒)" : "點擊開啟自動更新 (每10秒)"}
                                >
                                    {isAutoUpdate ? <Icon name="Pause" className="h-4 w-4" /> : <Icon name="Play" className="h-4 w-4" />}
                                    <span className="hidden sm:inline">{isAutoUpdate ? '停止更新' : '自動更新'}</span>
                                </button>

                                <button 
                                    onClick={() => setIsDataImportOpen(!isDataImportOpen)}
                                    className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded-lg transition text-xs md:text-sm border border-slate-600"
                                >
                                    <Icon name="Database" className="h-4 w-4" />
                                    <span className="hidden sm:inline">匯入資料庫</span>
                                </button>
                                <button 
                                    onClick={openPriceUpdateModal}
                                    className="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 px-3 py-2 rounded-lg transition text-xs md:text-sm font-medium shadow-lg shadow-blue-900/50"
                                >
                                    {fetchStatus === 'fetching' ? <Icon name="Wifi" className="h-4 w-4 animate-ping"/> : <Icon name="RefreshCw" className="h-4 w-4" />}
                                    手動/行情
                                </button>
                                <button 
                                    onClick={() => setIsResourcesOpen(true)}
                                    className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded-lg transition text-xs md:text-sm border border-slate-600 text-white"
                                    title="相關資源網站"
                                >
                                    <Icon name="Globe" className="h-4 w-4" />
                                    <span className="hidden sm:inline">資源</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* 資源連結視窗 */}
                    {isResourcesOpen && (
                        <div className="fixed inset-0 bg-black/50 z-30 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden animate-fade-in-up">
                                <div className="bg-slate-100 p-4 border-b flex justify-between items-center">
                                    <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                        <Icon name="Globe" className="h-5 w-5 text-blue-600" />
                                        即時股市資訊站
                                    </h3>
                                    <button onClick={() => setIsResourcesOpen(false)} className="text-gray-400 hover:text-gray-600"><Icon name="X" className="h-5 w-5"/></button>
                                </div>
                                <div className="p-6 grid grid-cols-1 md:grid-cols-1 gap-3">
                                    {resourceLinks.map((link, idx) => (
                                        <a 
                                            key={idx} 
                                            href={link.url} 
                                            target="_blank" 
                                            rel="noopener noreferrer" 
                                            className="flex items-center justify-between p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition group"
                                        >
                                            <div>
                                                <div className="font-bold text-slate-800 group-hover:text-blue-700">{link.name}</div>
                                                <div className="text-xs text-gray-500">{link.desc}</div>
                                            </div>
                                            <Icon name="ExternalLink" className="h-4 w-4 text-gray-400 group-hover:text-blue-500" />
                                        </a>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 資料匯入視窗 */}
                    {isDataImportOpen && (
                        <div className="fixed inset-0 bg-black/50 z-30 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden animate-fade-in-up">
                                <div className="bg-slate-100 p-4 border-b flex justify-between items-center">
                                    <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                        <Icon name="Database" className="h-5 w-5 text-blue-600" />
                                        更新股票代碼資料庫
                                    </h3>
                                    <button onClick={() => setIsDataImportOpen(false)} className="text-gray-400 hover:text-gray-600"><Icon name="X" className="h-5 w-5"/></button>
                                </div>
                                
                                <div className="p-6 space-y-4">
                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800">
                                        <p className="font-bold mb-1 flex items-center gap-2"><Icon name="AlertCircle" className="h-4 w-4"/> 說明</p>
                                        <p>請選取或拖曳您下載的 <b>C_public.htm</b> 等檔案。</p>
                                    </div>
                                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:bg-gray-50 transition cursor-pointer relative">
                                        <input 
                                            type="file" 
                                            accept=".htm,.html,.csv"
                                            multiple
                                            onChange={handleFileUpload}
                                            className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                        />
                                        <Icon name="FileCode" className="h-10 w-10 text-gray-400 mx-auto mb-3" />
                                        <p className="text-gray-600 font-medium">點擊選取檔案 或 拖曳至此</p>
                                    </div>
                                    {importStatus && (
                                        <div className={`text-center text-sm font-medium py-2 rounded ${importStatus.includes('成功') ? 'text-green-600 bg-green-50' : 'text-blue-600 bg-blue-50'}`}>
                                            {importStatus}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 價格更新視窗 */}
                    {isPriceUpdateOpen && (
                        <div className="fixed inset-0 bg-black/50 z-30 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full flex flex-col max-h-[90vh] animate-fade-in-up">
                                <div className="bg-blue-900 text-white p-4 flex justify-between items-center shrink-0 rounded-t-xl">
                                    <div>
                                        <h3 className="font-bold text-lg flex items-center gap-2">
                                            <Icon name="Edit3" className="h-5 w-5" />
                                            每日行情更新中心
                                        </h3>
                                    </div>
                                    <button onClick={() => setIsPriceUpdateOpen(false)} className="text-blue-200 hover:text-white"><Icon name="X" className="h-6 w-6"/></button>
                                </div>

                                <div className="p-4 bg-blue-50 border-b border-blue-100 flex gap-2 shrink-0 justify-between items-center">
                                    <p className="text-sm text-blue-800 flex items-center gap-2">
                                        <Icon name="WifiOff" className="h-4 w-4 text-red-500"/>
                                        因瀏覽器安全限制，無法自動爬取 Google 數據。請點擊連結查看即時股價後輸入。
                                    </p>
                                </div>
                                
                                <div className="overflow-y-auto p-4 md:p-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {stocks.map(stock => (
                                            <div key={stock.id} className="flex items-center gap-3 p-3 border rounded-lg hover:border-blue-300 bg-white shadow-sm">
                                                <div className="w-1/3">
                                                    <div className="flex items-center gap-2">
                                                        <span className={`text-[10px] px-1 rounded ${getMarketBadgeColor(stock.market)}`}>{stock.market || '上市'}</span>
                                                        <span className="font-bold text-gray-800">{stock.code}</span>
                                                    </div>
                                                    <div className="text-sm text-gray-600 truncate">{stock.name}</div>
                                                </div>
                                                
                                                <div className="w-1/3">
                                                    <a 
                                                        href={getStockLink(stock.code, stock.market)} 
                                                        target="_blank" 
                                                        rel="noopener noreferrer"
                                                        className="text-xs flex items-center gap-1 text-blue-600 hover:text-blue-800 hover:underline mb-1"
                                                    >
                                                        Yahoo 報價 <Icon name="ExternalLink" className="h-3 w-3" />
                                                    </a>
                                                    <div className="text-xs text-gray-400">
                                                        前值: {stock.currentPrice}
                                                    </div>
                                                </div>

                                                <div className="w-1/3 relative">
                                                    <span className="absolute left-2 top-2 text-gray-400 text-sm">$</span>
                                                    <input 
                                                        type="number" 
                                                        step="0.01"
                                                        value={priceUpdateData[stock.id] !== undefined ? priceUpdateData[stock.id] : stock.currentPrice} 
                                                        onChange={(e) => handlePriceUpdateChange(stock.id, e.target.value)}
                                                        className="w-full p-1.5 pl-5 border rounded focus:ring-2 focus:ring-blue-500 font-bold text-gray-800 text-right"
                                                    />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    {stocks.length === 0 && <p className="text-center text-gray-400 py-10">目前沒有庫存股票。</p>}
                                </div>

                                <div className="p-4 border-t bg-gray-50 flex justify-end gap-3 shrink-0 rounded-b-xl">
                                    <button onClick={() => setIsPriceUpdateOpen(false)} className="px-4 py-2 text-gray-600 hover:bg-gray-200 rounded">取消</button>
                                    <button onClick={saveBatchPrices} className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded shadow font-bold flex items-center gap-2">
                                        <Icon name="Save" className="h-4 w-4" />
                                        儲存更新
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <main className="max-w-7xl mx-auto p-4 md:p-6 space-y-6">
                        {/* Dashboard Summary */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition">
                                <p className="text-gray-500 text-xs md:text-sm font-medium">總投入成本</p>
                                <p className="text-lg md:text-2xl font-bold text-gray-900 mt-2">${totalCost.toLocaleString()}</p>
                            </div>
                            <div className="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition">
                                <p className="text-gray-500 text-xs md:text-sm font-medium">目前市值</p>
                                <p className={`text-lg md:text-2xl font-bold mt-2 transition-colors duration-500 ${isAutoUpdate && fetchStatus === 'fetching' ? 'text-gray-400' : 'text-blue-600'}`}>
                                    ${totalValue.toLocaleString()}
                                </p>
                            </div>
                            <div className="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition">
                                <p className="text-gray-500 text-xs md:text-sm font-medium">未實現損益</p>
                                <p className={`text-lg md:text-2xl font-bold mt-2 flex items-center gap-1 ${totalPL >= 0 ? 'text-red-500' : 'text-green-500'}`}>
                                    {totalPL >= 0 ? <Icon name="TrendingUp" className="h-4 w-4 md:h-5 md:w-5"/> : <Icon name="TrendingDown" className="h-4 w-4 md:h-5 md:w-5"/>}
                                    ${Math.abs(totalPL).toLocaleString()}
                                </p>
                            </div>
                            <div className="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition">
                                <p className="text-gray-500 text-xs md:text-sm font-medium">總報酬率</p>
                                <p className={`text-lg md:text-2xl font-bold mt-2 ${totalROI >= 0 ? 'text-red-500' : 'text-green-500'}`}>
                                    {totalROI.toFixed(2)}%
                                </p>
                            </div>
                        </div>

                        {/* Action Bar */}
                        <div className="flex justify-between items-center">
                            <h2 className="text-lg md:text-xl font-bold text-slate-800 flex items-center gap-2">
                                <Icon name="PieChart" className="h-5 w-5 text-slate-500"/>
                                持股明細
                            </h2>
                            <button 
                                onClick={() => {
                                    setEditingId(null);
                                    setNewStock({ ...newStock, code: '', name: '', shares: 1000, buyPrice: 0, currentPrice: 0 });
                                    setIsFormOpen(!isFormOpen);
                                }}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition transform active:scale-95 text-white ${isFormOpen ? 'bg-gray-500 hover:bg-gray-600' : 'bg-emerald-600 hover:bg-emerald-500'}`}
                            >
                                {isFormOpen ? <Icon name="X" className="h-5 w-5" /> : <Icon name="Plus" className="h-5 w-5" />}
                                <span className="hidden md:inline">{isFormOpen ? '關閉表單' : '新增交易紀錄'}</span>
                                <span className="md:hidden">{isFormOpen ? '關閉' : '新增'}</span>
                            </button>
                        </div>

                        {/* Add/Edit Stock Form */}
                        {isFormOpen && (
                            <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200 animate-fade-in-down">
                                <div className="flex justify-between items-center border-b pb-2 mb-4">
                                    <h3 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                        {editingId ? <Icon name="Edit3" className="h-5 w-5 text-orange-500"/> : <Icon name="FileCode" className="h-5 w-5 text-blue-500"/>}
                                        {editingId ? '編輯交易紀錄' : '新增交易紀錄'}
                                    </h3>
                                    {editingId && <span className="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">編輯模式</span>}
                                </div>

                                <form onSubmit={handleSaveStock} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="col-span-1 md:col-span-2 lg:col-span-4 bg-blue-50/50 p-4 rounded-lg border border-blue-100 mb-2">
                                        <h4 className="text-sm font-bold text-blue-800 mb-3 flex items-center gap-1">
                                            <Icon name="PenTool" className="h-4 w-4"/> 必填交易資料
                                        </h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-600 flex items-center gap-1">
                                                    股票代號 <span className="text-red-500">*</span>
                                                </label>
                                                <div className="relative">
                                                    <input 
                                                        required 
                                                        name="code" 
                                                        value={newStock.code} 
                                                        onChange={handleInputChange} 
                                                        placeholder="例如: 2330" 
                                                        className="w-full p-2 pl-3 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:ring-0 outline-none bg-white font-bold text-lg text-blue-900" 
                                                    />
                                                    {stockMasterData[newStock.code] && (
                                                        <div className="absolute right-3 top-3 text-green-600 text-xs font-bold flex items-center gap-1">
                                                            <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                                            已對應
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-600 flex items-center gap-1">
                                                    成交股數 <span className="text-red-500">*</span>
                                                </label>
                                                <input required type="number" name="shares" value={newStock.shares} onChange={handleInputChange} className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 outline-none font-medium" />
                                            </div>

                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-600 flex items-center gap-1">
                                                    購入單價 <span className="text-red-500">*</span>
                                                </label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 text-gray-400">$</span>
                                                    <input required type="number" step="0.01" name="buyPrice" value={newStock.buyPrice} onChange={handleInputChange} className="w-full p-2 pl-6 border-2 border-gray-200 rounded-lg focus:border-blue-500 outline-none font-medium" />
                                                </div>
                                            </div>

                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-600">購買日期</label>
                                                <input required type="date" name="buyDate" value={newStock.buyDate} onChange={handleInputChange} className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 outline-none text-gray-600" />
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-3 border-t border-blue-100">
                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-500">公司名稱 (可手動修改)</label>
                                                <input required name="name" value={newStock.name} onChange={handleInputChange} placeholder="自動帶出或手動輸入" className="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none text-gray-700" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-xs font-bold text-gray-500">目前市價 (預設等於買價)</label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 text-gray-400">$</span>
                                                    <input type="number" step="0.01" name="currentPrice" value={newStock.currentPrice} onChange={handleInputChange} className="w-full p-2 pl-6 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="col-span-1 md:col-span-2 lg:col-span-4 mt-2">
                                        <p className="text-xs font-bold text-gray-400 mb-2 uppercase tracking-wider flex items-center gap-2 cursor-pointer hover:text-gray-600">
                                            進階分析指標 (選填) <Icon name="ArrowRight" className="h-3 w-3"/>
                                        </p>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className="space-y-1">
                                                <label className="text-xs font-semibold text-gray-500">EPS</label>
                                                <input type="number" step="0.01" name="eps" value={newStock.eps} onChange={handleInputChange} className="w-full p-2 border rounded bg-yellow-50 focus:bg-white transition" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-xs font-semibold text-gray-500">本益比</label>
                                                <input type="number" step="0.01" name="pe" value={newStock.pe} onChange={handleInputChange} className="w-full p-2 border rounded bg-yellow-50 focus:bg-white transition" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-xs font-semibold text-gray-500">Beta 值</label>
                                                <input type="number" step="0.01" name="beta" value={newStock.beta} onChange={handleInputChange} className="w-full p-2 border rounded bg-yellow-50 focus:bg-white transition" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-xs font-semibold text-gray-500">標準差</label>
                                                <input type="number" step="0.01" name="stdDev" value={newStock.stdDev} onChange={handleInputChange} className="w-full p-2 border rounded bg-yellow-50 focus:bg-white transition" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="col-span-1 md:col-span-2 lg:col-span-4 flex justify-end gap-3 mt-4 border-t pt-4">
                                        <button type="button" onClick={cancelEdit} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">取消</button>
                                        <button type="submit" className={`px-6 py-2 text-white rounded shadow flex items-center gap-2 ${editingId ? 'bg-orange-500 hover:bg-orange-600' : 'bg-blue-600 hover:bg-blue-500'}`}>
                                            <Icon name="Save" className="h-4 w-4" />
                                            {editingId ? '更新紀錄' : '儲存股票'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {/* Stock Table */}
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm text-left whitespace-nowrap md:whitespace-normal">
                                    <thead className="bg-slate-50 text-slate-600 font-bold uppercase tracking-wider text-xs border-b border-slate-200">
                                        <tr>
                                            <th className="p-4">代號 / 名稱 / 產業</th>
                                            <th className="p-4 text-right">股數 / 均價</th>
                                            <th className="p-4 text-right text-blue-700 bg-blue-50/50">目前市價</th>
                                            <th className="p-4 text-right">現值</th>
                                            <th className="p-4 text-right">損益 ($)</th>
                                            <th className="p-4 text-right">報酬率 (%)</th>
                                            <th className="p-4 text-center bg-yellow-50/50 hidden md:table-cell">合理價估算</th>
                                            <th className="p-4 text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {stocks.map((stock) => {
                                            const cost = stock.buyPrice * stock.shares;
                                            const value = stock.currentPrice * stock.shares;
                                            const pl = value - cost;
                                            const roi = cost > 0 ? (pl / cost) * 100 : 0;
                                            const fairValue = calculateFairValue(stock.eps, stock.pe);

                                            return (
                                                <tr key={stock.id} className="hover:bg-slate-50 transition group">
                                                    <td className="p-4">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className={`text-[10px] px-1.5 py-0.5 rounded border ${getMarketBadgeColor(stock.market)}`}>
                                                                {stock.market || '上市'}
                                                            </span>
                                                            <span className="font-bold text-slate-900 text-base">{stock.code}</span>
                                                            <a href={getStockLink(stock.code, stock.market)} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-blue-600">
                                                                <Icon name="ExternalLink" className="h-3 w-3" />
                                                            </a>
                                                        </div>
                                                        <div className="font-medium text-slate-700">{stock.name}</div>
                                                        <div className="text-slate-400 text-xs mt-1">{stock.category}</div>
                                                    </td>
                                                    <td className="p-4 text-right">
                                                        <div className="font-mono text-slate-800 font-medium">{stock.shares.toLocaleString()} <span className="text-xs text-gray-400">股</span></div>
                                                        <div className="text-slate-500 text-xs">@ ${stock.buyPrice}</div>
                                                    </td>
                                                    <td className="p-4 text-right">
                                                        <div className={`font-mono font-bold text-blue-700 bg-blue-50/50 p-1 rounded transition-all duration-300 inline-block ${fetchStatus === 'fetching' ? 'opacity-50' : 'opacity-100'}`}>
                                                            ${stock.currentPrice}
                                                        </div>
                                                        <div className="text-[10px] text-gray-400 mt-1">{stock.lastUpdate || '未更新'}</div>
                                                    </td>
                                                    <td className="p-4 text-right font-medium text-slate-700">${value.toLocaleString()}</td>
                                                    <td className={`p-4 text-right font-bold ${pl >= 0 ? 'text-red-500' : 'text-green-500'}`}>
                                                        {pl > 0 ? '+' : ''}{pl.toLocaleString()}
                                                    </td>
                                                    <td className={`p-4 text-right font-bold ${roi >= 0 ? 'text-red-500' : 'text-green-500'}`}>
                                                        {roi.toFixed(2)}%
                                                    </td>
                                                    <td className="p-4 text-center bg-yellow-50/50 hidden md:table-cell text-slate-500">
                                                        {fairValue > 0 ? `$${fairValue}` : '-'}
                                                    </td>
                                                    <td className="p-4 text-center">
                                                        <div className="flex justify-center gap-2">
                                                            <button 
                                                                onClick={() => handleEditStock(stock)}
                                                                className="text-gray-400 hover:text-orange-500 transition p-2 hover:bg-orange-50 rounded-full"
                                                                title="編輯"
                                                            >
                                                                <Icon name="Edit3" className="h-4 w-4" />
                                                            </button>
                                                            <button 
                                                                onClick={() => deleteStock(stock.id)}
                                                                className="text-gray-400 hover:text-red-500 transition p-2 hover:bg-red-50 rounded-full"
                                                                title="刪除"
                                                            >
                                                                <Icon name="Trash2" className="h-4 w-4" />
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                            {stocks.length === 0 && (
                                <div className="p-16 text-center text-gray-400 flex flex-col items-center justify-center">
                                    <div className="bg-gray-100 p-4 rounded-full mb-4">
                                        <Icon name="PieChart" className="h-8 w-8 text-gray-300" />
                                    </div>
                                    <p className="text-lg font-medium text-gray-500">目前投資組合為空</p>
                                    <p className="text-sm mt-1">請點擊上方「新增交易紀錄」開始管理您的資產</p>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StockPortfolioApp />);
    </script>
</body>
</html>
